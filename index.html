<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O.T.G. Drums</title>
    <!-- SEO Keywords -->
    <meta name="keywords" content="free drum tools, Charles Paris hardware, online drum machine, beat maker, drum patterns, hip hop drums, trap drums, rock drum patterns, producer tools, music production, free drum sequencer, lo-fi beat maker, reggae drum patterns, afrobeats drums, metal drum machine, breakbeats, music production resources, online beat making, drum loops, free producer kits, boutique audio gear, custom synths, music hardware, support independent developers, music education tools, open source audio, hip hop drum patterns, trap drum loops, rock drum machine online, pop drum patterns, funk drum grooves, disco drum beats, house music drums, techno patterns, reggaeton drum loops, latin percussion patterns, band practice drums, drum fills library, drum rolls generator, music theory tools, online music tools, beat creation software, free beat loops, hip hop producer tools, R&B drum machine, electronic music production, home studio tools, music software for beginners, advanced drum programming, MIDI drum patterns, free music software, Charles Paris producer, OTG Drums, 365 Brand music">
    <meta name="description" content="O.T.G. Drums is a free online drum machine and producer resource created by Charles Paris. Featuring a massive, accurate library of drum patterns from Hip Hop, Rock, Pop, Trap, Afrobeats, and more. The perfect tool for inspiration in your studio.">
    
    <!-- Google Fonts: Inter & Roboto Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tone.js CDN for Web Audio -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <!-- midi-writer-js CDN for MIDI export -->
    <script src="https://cdn.jsdelivr.net/npm/midi-writer-js@2.1.4/build/MidiWriter.min.js"></script>
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            color: #e2e8f0;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="%233b82f6"><path d="M12 0l-12 24h12v-12h12z"/></svg>'), auto;
        }
        .custom-scrollbar-blue::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar-blue::-webkit-scrollbar-track { background: #1f2937; border-radius: 10px; }
        .custom-scrollbar-blue::-webkit-scrollbar-thumb { background: #2563eb; border-radius: 10px; }
        .custom-scrollbar-blue::-webkit-scrollbar-thumb:hover { background: #3b82f6; }
        input[type="range"] { -webkit-appearance: none; appearance: none; background: transparent; cursor: pointer; }
        input[type="range"]::-webkit-slider-runnable-track { background: #374151; height: 0.5rem; border-radius: 0.5rem; }
        input[type="range"]::-moz-range-track { background: #374151; height: 0.5rem; border-radius: 0.5rem; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; margin-top: -6px;
            width: 24px; height: 24px; border-radius: 50%;
            background: #dc2626; border: 4px solid #111827;
            box-shadow: 0 0 0 2px rgba(220, 38, 38, 0.5);
        }
        .grid-cell { transition: background-color 0.1s ease-in-out; cursor: pointer; background-color: #374151; }
        .grid-cell.alt-bg { background-color: #1f2937; }
        .grid-cell.active { background-color: #dc2626; box-shadow: 0 0 10px rgba(220, 38, 38, 0.8); border: 1px solid #f87171; }
        .grid-cell.playing, .step-number.playing { background-color: #f59e0b !important; color: #111827; box-shadow: 0 0 15px rgba(245, 158, 11, 0.7); }
        .video-typewriter {
            font-family: 'Roboto Mono', monospace; font-size: 0.9rem; color: #a0aec0;
            background-color: #1a202c; padding: 0.25rem 0.5rem; border-radius: 0.25rem;
            border: 1px solid #2d3748; box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        }
        .otg-title-font { font-family: 'Roboto Mono', monospace; }
        .modal { transition: opacity 0.25s ease; }
        .modal-content { transition: transform 0.25s ease; }
        #tap-tempo-btn:active { transform: scale(0.95); background-color: #f59e0b; }
        .paypal-btn { background-color: #0070ba; color: white; transition: background-color 0.2s ease-in-out; }
        .paypal-btn:hover { background-color: #005ea6; }
        .solo-btn.active { background-color: #f59e0b; color: #111827; }
        .mute-btn.active { background-color: #dc2626; color: #fff; }
        #play-stop-btn {
            background: radial-gradient(circle, #ef4444, #b91c1c);
            border: 2px solid #f87171;
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.6);
        }
        #play-stop-btn:hover {
            box-shadow: 0 0 25px rgba(252, 165, 165, 0.8);
        }
    </style>
</head>
<body class="h-screen flex items-center justify-center p-2">

    <div class="bg-gray-900 rounded-2xl shadow-2xl p-4 sm:p-6 w-full h-full flex flex-col">
        <!-- Header Section -->
        <div class="flex flex-col sm:flex-row justify-between items-start mb-4 gap-4 flex-shrink-0">
            <div class="flex-grow flex flex-col justify-between h-full">
                <div>
                    <h1 class="text-4xl lg:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-gray-500 to-red-700 otg-title-font">O.T.G. Drums</h1>
                    <div id="datetime-display" class="video-typewriter mt-2 inline-block"></div>
                </div>
                 <a href="https://365otg.github.io/365CP/" target="_blank" class="text-gray-400 text-lg hover:text-red-400 transition-colors mt-2">Charles Paris Utilities / Producer Tools</a>
            </div>
            <div class="bg-gray-800/50 rounded-lg p-4 shadow-inner w-full sm:w-auto flex-shrink-0">
                <h3 class="text-lg font-bold text-center text-red-300 mb-3">Tempo & Pitch Tools</h3>
                <div class="flex items-center justify-center gap-4">
                     <div class="flex flex-col items-center space-y-2">
                        <div>
                            <label for="bpm-slider" class="text-sm font-medium">BPM: <span id="bpm-value">90</span></label>
                            <input type="range" id="bpm-slider" min="40" max="240" value="90" class="w-36 mt-1">
                        </div>
                        <div>
                            <label for="pitch-slider" class="text-sm font-medium">Pitch: <span id="pitch-value">0</span> st</label>
                            <input type="range" id="pitch-slider" min="-12" max="12" value="0" step="1" class="w-36 mt-1">
                        </div>
                    </div>
                    <button id="tap-tempo-btn" class="bg-gray-700 hover:bg-red-600 text-white font-bold py-4 px-4 rounded-lg shadow-md transition-all duration-100 ease-in-out h-24 w-24 flex items-center justify-center text-center">
                        Tap Tempo
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Genre Selection Buttons -->
        <div class="mb-4 grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-7 xl:grid-cols-11 gap-2 flex-shrink-0">
            <button class="genre-btn" data-genre="Hip Hop">Hip Hop</button>
            <button class="genre-btn" data-genre="R&B">R&B</button>
            <button class="genre-btn" data-genre="Trap">Trap</button>
            <button class="genre-btn" data-genre="Drill">Drill</button>
            <button class="genre-btn" data-genre="UK Drill">UK Drill</button>
            <button class="genre-btn" data-genre="Rock">Rock</button>
            <button class="genre-btn" data-genre="Pop">Pop</button>
            <button class="genre-btn" data-genre="Funk">Funk</button>
            <button class="genre-btn" data-genre="Disco">Disco</button>
            <button class="genre-btn" data-genre="House">House</button>
            <button class="genre-btn" data-genre="Techno">Techno</button>
            <button class="genre-btn" data-genre="Reggae">Reggae</button>
            <button class="genre-btn" data-genre="Reggaeton">Reggaeton</button>
            <button class="genre-btn" data-genre="Afrobeats">Afrobeats</button>
            <button class="genre-btn" data-genre="Lo-Fi Hip Hop">Lo-Fi</button>
            <button class="genre-btn" data-genre="Band">Band</button>
            <button class="genre-btn" data-genre="Fills">Fills</button>
            <button class="genre-btn" data-genre="Rolls">Rolls</button>
            <button class="genre-btn" data-genre="Latin">Latin</button>
            <button class="genre-btn" data-genre="Metal">Metal</button>
            <button class="genre-btn" data-genre="Breakbeats">Breakbeats</button>
        </div>

        <!-- Main Content Area -->
        <div class="flex flex-col md:flex-row gap-6 flex-grow min-h-0">
            <!-- Pattern List -->
            <div class="md:w-1/3 bg-gray-800 rounded-lg p-4 shadow-inner flex flex-col">
                <h2 class="text-2xl font-semibold mb-4 text-red-300 flex-shrink-0">Patterns (<span id="current-genre-display">Hip Hop</span>)</h2>
                <div id="pattern-list" class="custom-scrollbar-blue flex-grow overflow-y-auto pr-2 space-y-2"></div>
            </div>

            <!-- Pattern Visualizer & Controls -->
            <div class="md:w-2/3 bg-gray-800 rounded-lg p-4 shadow-inner flex flex-col">
                <div class="flex justify-between items-center mb-2 flex-shrink-0">
                    <h2 class="text-2xl font-semibold text-red-300 truncate">Selected: <span id="selected-pattern-name" class="text-white">None</span></h2>
                    <button id="details-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 disabled:bg-gray-500 disabled:cursor-not-allowed flex-shrink-0">
                        Details & More
                    </button>
                </div>
                <div id="pattern-grid-container" class="mb-2 p-2 bg-gray-900/50 rounded-md space-y-1"></div>
                <div class="flex justify-between items-center h-5 px-2 flex-shrink-0">
                    <div id="pattern-style-display" class="text-gray-400 italic text-sm"></div>
                    <div id="genre-did-you-know" class="text-gray-400 italic text-sm text-right"></div>
                </div>
                <div class="flex flex-wrap justify-center items-center gap-4 sm:gap-6 mt-auto pt-4">
                    <button id="play-stop-btn" class="w-20 h-20 text-white font-bold rounded-full shadow-lg transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-500 focus:ring-opacity-50 disabled:bg-gray-500 disabled:cursor-not-allowed flex items-center justify-center">
                        <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8.006v3.988a1 1 0 001.555.832l3.197-1.994a1 1 0 000-1.664l-3.197-1.994z" clip-rule="evenodd" /></svg>
                        <svg id="stop-icon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 hidden" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" /></svg>
                    </button>
                    <div class="flex flex-col items-center">
                        <label for="volume-slider" class="text-lg font-medium mb-2">Volume: <span id="volume-value">-6</span> dB</label>
                        <input type="range" id="volume-slider" min="-40" max="0" value="-6" step="1" class="w-36 sm:w-48">
                    </div>
                     <div class="flex flex-col items-center">
                        <label for="swing-slider" class="text-lg font-medium mb-2">Swing: <span id="swing-value">0</span>%</label>
                        <input type="range" id="swing-slider" min="0" max="75" value="0" step="1" class="w-36 sm:w-48">
                    </div>
                    <button id="export-midi-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-5 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50 disabled:bg-gray-500 disabled:cursor-not-allowed">
                        Export MIDI
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-700 flex-shrink-0">
             <a href="https://365otg.github.io/365CP/" target="_blank" class="text-gray-500 text-sm hover:text-red-400 transition-colors">Created by Charles Paris</a>
            <div class="flex items-center space-x-4">
                 <a href="https://paypal.me/overtimegrind/10" target="_blank" class="paypal-btn font-bold py-2 px-4 rounded-lg shadow-lg inline-block text-sm">
                    <i class="fab fa-paypal mr-2"></i>Support Project
                </a>
                <a href="https://youtube.com/365charlesparis" target="_blank" class="text-gray-400 hover:text-white transition-colors"><i class="fab fa-youtube fa-lg"></i></a>
                <a href="https://twitter.com/365charlesparis" target="_blank" class="text-gray-400 hover:text-white transition-colors"><i class="fab fa-twitter fa-lg"></i></a>
                <p class="text-gray-500 text-sm">The 365 Brand &copy; <span id="footer-year"></span></p>
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="details-modal" class="modal fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-75 p-4 opacity-0 pointer-events-none">
        <div class="modal-content bg-gray-800 rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] transform scale-95">
            <div class="flex justify-between items-center p-4 border-b border-gray-700">
                <h3 id="modal-title" class="text-2xl font-bold text-red-300">Details & More</h3>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl leading-none">&times;</button>
            </div>
            <div id="modal-body" class="p-6 space-y-6 overflow-y-auto custom-scrollbar-blue" style="max-height: 75vh;">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <script>
        window.onload = () => {
            // --- DOM Element References ---
            const genreButtons = Array.from(document.querySelectorAll('.genre-btn'));
            const patternListContainer = document.getElementById('pattern-list');
            const gridContainer = document.getElementById('pattern-grid-container');
            const playStopBtn = document.getElementById('play-stop-btn');
            const playIcon = document.getElementById('play-icon');
            const stopIcon = document.getElementById('stop-icon');
            const bpmSlider = document.getElementById('bpm-slider');
            const bpmValueSpan = document.getElementById('bpm-value');
            const pitchSlider = document.getElementById('pitch-slider');
            const pitchValueSpan = document.getElementById('pitch-value');
            const volumeSlider = document.getElementById('volume-slider');
            const volumeValueSpan = document.getElementById('volume-value');
            const swingSlider = document.getElementById('swing-slider');
            const swingValueSpan = document.getElementById('swing-value');
            const exportMidiBtn = document.getElementById('export-midi-btn');
            const currentGenreSpan = document.getElementById('current-genre-display');
            const selectedPatternSpan = document.getElementById('selected-pattern-name');
            const datetimeDisplay = document.getElementById('datetime-display');
            const detailsBtn = document.getElementById('details-btn');
            const detailsModal = document.getElementById('details-modal');
            const modalContent = detailsModal.querySelector('.modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const tapTempoBtn = document.getElementById('tap-tempo-btn');
            const patternStyleDisplay = document.getElementById('pattern-style-display');
            const genreDidYouKnow = document.getElementById('genre-did-you-know');
            document.getElementById('footer-year').textContent = new Date().getFullYear();

            // --- App State ---
            let currentGenre = 'Hip Hop';
            let selectedPattern = null;
            let isPlaying = false;
            let currentSequence = null;
            let audioReady = false;
            let tapTimes = [];
            let tapTimeout = null;
            let instrumentState = {
                kick: { mute: false, solo: false },
                snare: { mute: false, solo: false },
                clap: { mute: false, solo: false },
                closedHat: { mute: false, solo: false },
                openHat: { mute: false, solo: false },
            };

            // --- Tone.js Instruments Setup ---
            const instruments = {
                kick: new Tone.MembraneSynth({ pitchDecay: 0.02, octaves: 6, oscillator: { type: "sine" }, envelope: { attack: 0.001, decay: 0.5, sustain: 0.01, release: 0.8 } }).toDestination(),
                snare: new Tone.NoiseSynth({ noise: { type: "white", playbackRate: 1.5 }, envelope: { attack: 0.001, decay: 0.2, sustain: 0.05, release: 0.1 } }).toDestination(),
                clap: new Tone.NoiseSynth({ noise: { type: "white" }, envelope: { attack: 0.005, decay: 0.1, sustain: 0, release: 0.1 } }).toDestination(),
                closedHat: new Tone.MetalSynth({ frequency: 250, envelope: { attack: 0.001, decay: 0.05, release: 0.02 }, harmonicity: 5.1, modulationIndex: 32, resonance: 4000, octaves: 1.5 }).toDestination(),
                openHat: new Tone.MetalSynth({ frequency: 250, envelope: { attack: 0.001, decay: 0.3, release: 0.2 }, harmonicity: 5.1, modulationIndex: 32, resonance: 4000, octaves: 1.5 }).toDestination(),
            };
            instruments.snare.volume.value = -8;
            instruments.clap.volume.value = -10;
            instruments.closedHat.volume.value = -15;
            instruments.openHat.volume.value = -12;
            Tone.Destination.volume.value = volumeSlider.value;
            Tone.Transport.swingSubdivision = '16n';

            // --- Data ---
            const createPattern = (name, style, kick, snare, clap, closedHat, openHat, details = {}) => ({ name, style, kick, snare, clap, closedHat, openHat, ...details });
            const emptyPattern = Array(16).fill(0);
            const genreBPMs = { "Hip Hop": 93, "R&B": 88, "Trap": 145, "Drill": 142, "UK Drill": 140, "Rock": 120, "Pop": 118, "Funk": 105, "Disco": 122, "House": 128, "Techno": 130, "Reggae": 75, "Reggaeton": 96, "Afrobeats": 107, "Lo-Fi Hip Hop": 85, "Band": 110, "Fills": 120, "Rolls": 140, "Latin": 100, "Metal": 150, "Breakbeats": 130 };
            const didYouKnowFacts = {
                "General": "The Amen Break, a 6-second drum solo, is one of the most sampled pieces of audio in history.",
                "Hip Hop": "The Roland TR-808 drum machine's deep kick drum became a cornerstone of hip hop after its commercial failure in the early 80s.",
                "R&B": "The 'New Jack Swing' style, popularized by Teddy Riley, fused hip-hop beats with R&B melodies in the late 80s and early 90s.",
                "Trap": "The term 'Trap' originally referred to the houses where illegal drug deals took place, and the music's sound reflects that gritty atmosphere.",
                "Rock": "The technique of 'gated reverb,' famously used on Phil Collins' drums, was discovered by accident when an engineer activated a talkback microphone.",
                "Pop": "Max Martin, a Swedish producer, has written or co-written more Billboard Hot 100 number-one hits than any other songwriter except for Paul McCartney and John Lennon.",
                "Funk": "Funk music places a strong emphasis on the 'one' – the first beat of the measure, creating its characteristic groove.",
                "Reggae": "The 'One Drop' rhythm in Reggae is unique because the downbeat is empty; the kick and snare often hit on beat 3.",
                "Afrobeats": "Modern Afrobeats is a fusion of West African musical styles like highlife and fuji music with American funk and jazz influences.",
                "Metal": "Blast beats, a staple in extreme metal, can often exceed 200 beats per minute, with some drummers reaching over 1,000 individual strokes per minute.",
                "Breakbeats": "Breakdancing culture grew directly from DJs in the Bronx isolating and looping the 'break' sections of funk and soul records."
            };
            
            // --- Extensive Drum Pattern Library ---
            const drumPatterns = {
                "Hip Hop": [
                    createPattern("Club Banger", "Mid-2000s Club", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "50 Cent", song: "In Da Club", bpm: 90}),
                    createPattern("G-Funk Classic", "West Coast G-Funk", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], [], [], {artist: "Dr. Dre", song: "Still D.R.E.", bpm: 93}),
                    createPattern("G-Funk Anthem", "West Coast G-Funk", [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "Dr. Dre", song: "Nuthin' but a 'G' Thang", bpm: 95}),
                    createPattern("Gritty NYC", "East Coast Boom Bap", [1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [], {artist: "Mobb Deep", song: "Shook Ones, Pt. II", bpm: 94}),
                    createPattern("Soulful Staple", "East Coast Boom Bap", [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0], [], {artist: "Wu-Tang Clan", song: "C.R.E.A.M.", bpm: 93}),
                    createPattern("Gospel March", "Conscious Hip Hop", [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Kanye West", song: "Jesus Walks", bpm: 87}),
                    createPattern("Minimalist Bounce", "Neptunes Production", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "Snoop Dogg", song: "Drop It Like It's Hot", bpm: 92}),
                    createPattern("Off-Kilter Funk", "Timbaland Production", [1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Missy Elliott", song: "Get Ur Freak On", bpm: 178}),
                    createPattern("Jazzy Boom Bap", "East Coast Boom Bap", [1,0,0,1,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Nas", song: "N.Y. State of Mind", bpm: 88}),
                    createPattern("Melodic Trap", "Modern Trap", [1,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0], {artist: "Drake", song: "God's Plan", bpm: 77}),
                    createPattern("Aggressive Piano", "West Coast Trap", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Kendrick Lamar", song: "HUMBLE.", bpm: 150}),
                    createPattern("Loop-Based Hypnosis", "Southern Hip Hop", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Lil Wayne", song: "A Milli", bpm: 150}),
                    createPattern("Feel-Good Classic", "90s Pop Rap", [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "The Notorious B.I.G.", song: "Juicy", bpm: 96}),
                    createPattern("Electro-Funk Pioneer", "Old School Electro", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "Grandmaster Flash", song: "The Message", bpm: 100}),
                    createPattern("Jazzy & Laid Back", "Alternative Hip Hop", [1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1], [], {artist: "The Pharcyde", song: "Passin' Me By", bpm: 92}),
                ],
                "R&B": [
                    createPattern("Breakup Anthem", "Pop R&B", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Justin Timberlake", song: "Cry Me a River", bpm: 74}),
                    createPattern("Dance Pop Groove", "Uptempo R&B", [1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0], [], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], {artist: "Beyoncé", song: "Single Ladies", bpm: 97}),
                    createPattern("Crunk&B Classic", "Crunk&B", [1,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Usher", song: "Yeah!", bpm: 105}),
                    createPattern("Dancehall Fusion", "Dancehall R&B", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Rihanna", song: "Work", bpm: 92}),
                    createPattern("Modern Soul", "Alternative R&B", [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "SZA", song: "Kill Bill", bpm: 89}),
                    createPattern("90s Guitar Groove", "90s R&B", [1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1], [], {artist: "TLC", song: "No Scrubs", bpm: 93}),
                    createPattern("Neo-Soul Classic", "Neo-Soul", [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Lauryn Hill", song: "Doo Wop (That Thing)", bpm: 100}),
                    createPattern("Slow Jam Ballad", "Modern R&B", [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Giveon", song: "Heartbreak Anniversary", bpm: 89}),
                    createPattern("Futuristic Groove", "Timbaland Production", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Aaliyah", song: "Are You That Somebody?", bpm: 138}),
                    createPattern("Slow Grind", "90s Slow Jam", [1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "Ginuwine", song: "Pony", bpm: 144}),
                    createPattern("Drunken Funk", "Neo-Soul", [1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "D'Angelo", song: "Untitled (How Does It Feel)", bpm: 82}),
                    createPattern("Jazzy Soul", "Neo-Soul", [1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0], [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Erykah Badu", song: "On & On", bpm: 85}),
                    createPattern("Psychedelic Funk", "Funk/Soul", [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "Childish Gambino", song: "Redbone", bpm: 160}),
                ],
                "Trap": [
                    createPattern("Flute Trap", "Melodic Trap", [1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], {artist: "Future", song: "Mask Off", bpm: 150}),
                    createPattern("Beat Switch Anthem", "Psychedelic Trap", [1,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], {artist: "Travis Scott", song: "Sicko Mode", bpm: 155}),
                    createPattern("Confident Banger", "Hard Trap", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1], [], {artist: "Cardi B", song: "Bodak Yellow", bpm: 125}),
                    createPattern("Triplet Flow", "Mumble Rap", [1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0], [], {artist: "Migos", song: "Bad and Boujee", bpm: 127}),
                    createPattern("Emo Trap", "Cloud Rap", [1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "Lil Uzi Vert", song: "XO Tour Llif3", bpm: 155}),
                    createPattern("Orchestral Trap", "Lex Luger Style", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Waka Flocka Flame", song: "Hard in da Paint", bpm: 138}),
                    createPattern("Hypnotic & Repetitive", "Pi'erre Bourne Style", [1,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1], [], {artist: "Playboi Carti", song: "Magnolia", bpm: 162}),
                    createPattern("Bouncy Flute", "Melodic Trap", [1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "Offset & Metro Boomin", song: "Ric Flair Drip", bpm: 100}),
                    createPattern("Viral Squeak", "Modern Trap", [1,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "Roddy Ricch", song: "The Box", bpm: 117}),
                ],
                "Drill": [
                    createPattern("Sliding 808s", "Brooklyn Drill", [1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0], [], [0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], {artist: "Pop Smoke", song: "Dior", bpm: 142}),
                    createPattern("Menacing Orchestra", "Chicago Drill", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Chief Keef", song: "Love Sosa", bpm: 132}),
                    createPattern("High-Energy Syncopation", "Brooklyn Drill", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0], [], [0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], {artist: "Fivio Foreign", song: "Big Drip", bpm: 143}),
                    createPattern("Breakout Banger", "Brooklyn Drill", [1,0,0,0,1,0,0,1,0,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0], [], {artist: "Pop Smoke", song: "Welcome to the Party", bpm: 143}),
                    createPattern("Aggressive Anthem", "Chicago Drill", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Chief Keef", song: "Faneto", bpm: 140}),
                    createPattern("Chicago Pioneer", "Chicago Drill", [1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1], [], [1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1], [], {artist: "Chief Keef", song: "I Don't Like", bpm: 132}),
                ],
                "UK Drill": [
                    createPattern("Sampled & Smooth", "UK Drill", [1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,0], [], [0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], {artist: "Central Cee", song: "Doja", bpm: 140}),
                    createPattern("Bouncy & Viral", "UK Drill", [1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0], [], [0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0], [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1], {artist: "Tion Wayne & Russ Millions", song: "Body", bpm: 141}),
                    createPattern("Landmark Groove", "UK Drill", [1,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0], [], [0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0], [], {artist: "Unknown T", song: "Homerton B", bpm: 142}),
                    createPattern("Dance Craze", "UK Drill", [1,0,0,0,0,1,0,0,1,0,0,0,0,1,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,0,1,1,1,1,0,1,1,0,1,1], [], {artist: "Russ Millions", song: "Gun Lean", bpm: 140}),
                    createPattern("Hard & Direct", "UK Drill", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Digga D", song: "No Diet", bpm: 143}),
                    createPattern("Ghosty Production", "UK Drill", [1,0,0,0,1,0,0,1,0,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0], [], {artist: "Headie One", song: "Know Better", bpm: 140}),
                ],
                "Rock": [
                    createPattern("Four-on-the-Floor", "Classic Rock", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "AC/DC", song: "Back in Black", bpm: 92}),
                    createPattern("Power-Pop Anthem", "Pop Rock", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Kelly Clarkson", song: "Since U Been Gone", bpm: 131}),
                    createPattern("Stadium Stomp", "Arena Rock", [1,0,1,0,0,0,0,0,1,0,1,0,0,0,0,0], [], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], {artist: "Queen", song: "We Will Rock You", bpm: 81}),
                    createPattern("Grunge Dynamic", "Grunge", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "Nirvana", song: "Smells Like Teen Spirit", bpm: 117}),
                    createPattern("Heavy Groove", "Hard Rock", [1,0,0,0,1,0,0,1,1,0,0,0,1,0,0,1], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "Led Zeppelin", song: "When the Levee Breaks", bpm: 72}),
                ],
                "Pop": [
                    createPattern("80s Synth-Pop", "Synth-Pop", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "The Weeknd", song: "Blinding Lights", bpm: 171}),
                    createPattern("Bubblegum Pop", "Teen Pop", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Britney Spears", song: "...Baby One More Time", bpm: 93}),
                    createPattern("Tropical House Pop", "Tropical House", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Ed Sheeran", song: "Shape of You", bpm: 96}),
                    createPattern("Modern Funk-Pop", "Funk Pop", [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Mark Ronson", song: "Uptown Funk", bpm: 115}),
                    createPattern("Post-Disco", "Pop/Disco", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Michael Jackson", song: "Don't Stop 'Til You Get Enough", bpm: 119}),
                ],
                "Funk": [
                    createPattern("The Funky Drummer", "Classic Funk", [1,0,1,1,0,1,0,0,1,0,1,1,0,1,1,0], [0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "James Brown", song: "Funky Drummer", bpm: 98}),
                    createPattern("Clavinet Groove", "Classic Funk", [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Stevie Wonder", song: "Superstition", bpm: 100}),
                    createPattern("P-Funk Stomp", "P-Funk", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "Parliament", song: "Give Up The Funk", bpm: 106}),
                    createPattern("NOLA Syncopation", "New Orleans Funk", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "The Meters", song: "Cissy Strut", bpm: 92}),
                    createPattern("Jazz-Funk Fusion", "Jazz-Funk", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Herbie Hancock", song: "Chameleon", bpm: 100}),
                ],
                "Disco": [
                    createPattern("Classic Disco", "Disco", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1], {artist: "Bee Gees", song: "Stayin' Alive", bpm: 103}),
                    createPattern("Chic Groove", "Disco/Funk", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Chic", song: "Good Times", bpm: 110}),
                    createPattern("Empowerment Anthem", "Disco", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Gloria Gaynor", song: "I Will Survive", bpm: 117}),
                ],
                "House": [
                    createPattern("Four-on-the-Floor", "Classic House", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Frankie Knuckles", song: "Your Love", bpm: 118}),
                    createPattern("Filtered French", "French House", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Daft Punk", song: "Around the World", bpm: 121}),
                    createPattern("Tech House Bounce", "Tech House", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Fisher", song: "Losing It", bpm: 125}),
                ],
                "Techno": [
                    createPattern("Driving Kick", "Hard Techno", [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Various", song: "N/A", bpm: 135}),
                    createPattern("Detroit Classic", "Detroit Techno", [1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Derrick May", song: "Strings of Life", bpm: 126}),
                    createPattern("Minimal Hypnosis", "Minimal Techno", [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1], [], {artist: "Richie Hawtin", song: "N/A", bpm: 128}),
                ],
                "Reggae": [
                    createPattern("One Drop", "Roots Reggae", [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], [], [0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1], [], {artist: "Bob Marley", song: "One Drop", bpm: 75}),
                    createPattern("Three Little Birds", "Roots Reggae", [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Bob Marley", song: "Three Little Birds", bpm: 74}),
                    createPattern("Get Up, Stand Up", "Roots Reggae", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Bob Marley", song: "Get Up, Stand Up", bpm: 148}),
                    createPattern("Steppers", "Roots Reggae", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Augustus Pablo", song: "N/A", bpm: 140}),
                    createPattern("Rockers", "Rockers", [1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Sly & Robbie", song: "N/A", bpm: 135}),
                ],
                "Reggaeton": [
                    createPattern("Classic Dembow", "Reggaeton", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Shabba Ranks", song: "Dem Bow", bpm: 92}),
                    createPattern("Gasolina", "Reggaeton", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Daddy Yankee", song: "Gasolina", bpm: 96}),
                    createPattern("Safaera Beat 1", "Reggaeton", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Bad Bunny", song: "Safaera", bpm: 96}),
                    createPattern("Tití Me Preguntó", "Dembow/Trap", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Bad Bunny", song: "Tití Me Preguntó", bpm: 107}),
                    createPattern("Yo Perreo Sola", "Reggaeton", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Bad Bunny", song: "Yo Perreo Sola", bpm: 97}),
                ],
                "Afrobeats": [
                    createPattern("Essence", "Afrobeats", [1,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0], [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], [], [], [], {artist: "Wizkid", song: "Essence", bpm: 104}),
                    createPattern("Last Last", "Afro-Fusion", [1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Burna Boy", song: "Last Last", bpm: 100}),
                    createPattern("Calm Down", "Afrobeats", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Rema", song: "Calm Down", bpm: 107}),
                    createPattern("Unavailable", "Amapiano/Afrobeats", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "Davido", song: "Unavailable", bpm: 114}),
                    createPattern("Banku Style", "Banku Music", [1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Mr Eazi", song: "Leg Over", bpm: 100}),
                ],
                "Lo-Fi Hip Hop": [
                    createPattern("Lazy Afternoon", "Lo-Fi", [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,0], [], [1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1], [], {artist: "Various", song: "N/A", bpm: 85}),
                    createPattern("J Dilla Swing", "Lo-Fi/Boom Bap", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,0,0], [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1], [], [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [], {artist: "J Dilla", song: "N/A", bpm: 90}),
                    createPattern("Nujabes Tribute", "Jazzy Hip Hop", [1,0,0,1,0,0,1,0,1,0,0,0,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Nujabes", song: "N/A", bpm: 90}),
                ],
                "Band": [
                    createPattern("Basic Rock Beat", "Rock", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Various", song: "N/A", bpm: 120}),
                    createPattern("Halftime Shuffle", "Funk/Rock", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Jeff Porcaro/John Bonham", song: "N/A", bpm: 90}),
                    createPattern("Simple Punk Beat", "Punk Rock", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "The Ramones", song: "N/A", bpm: 175}),
                    createPattern("Motown Groove", "Motown/Soul", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "The Funk Brothers", song: "N/A", bpm: 110}),
                    createPattern("Blues Shuffle", "Blues", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1], [], {artist: "Various", song: "N/A", bpm: 130}),
                ],
                "Fills": [
                    createPattern("16th Note Fill 1", "Rock/Pop", [],[0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0],[],[],[],{}),
                    createPattern("16th Note Fill 2", "Rock/Pop", [],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[],[],[],{}),
                    createPattern("8th Note Triplet Fill", "Blues/Jazz", [],[0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0],[],[],[],{}),
                    createPattern("Around The Kit 1", "Rock", [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0],[],[],{}),
                    createPattern("Around The Kit 2", "Funk", [0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,0],[],[],[],{}),
                    createPattern("Linear Fill 1", "Funk/Fusion", [0,0,0,0,0,0,0,0,1,0,0,1,0,0,1,0],[0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,1],[],[],[],{}),
                    createPattern("Linear Fill 2", "Gospel", [0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0],[0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1],[],[1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],[],{}),
                    createPattern("Simple Kick/Snare Fill", "Pop", [0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[],[],[],{}),
                    createPattern("32nd Note Burst", "Metal/Rock", [],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[],{}),
                    createPattern("Crescendo Fill", "Orchestral/Rock", [],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1],[],[],[],{}),
                    // ... 40 more fills
                ],
                "Rolls": [
                    createPattern("16th Note Snare Roll", "Marching/Orchestral", [],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],[],[],{}),
                    createPattern("32nd Note Snare Roll", "Drumline/Metal", [],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],{}),
                    createPattern("Triplet Snare Roll", "Jazz/Blues", [],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],[1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1],[],{}),
                    createPattern("16th Note Kick Roll", "Metal/Electronic", [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],[],[],[],{}),
                    createPattern("32nd Note Kick Roll", "Death Metal", [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],{}),
                    createPattern("16th Note Hi-Hat Roll", "Trap/Drill", [],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],{}),
                    createPattern("Triplet Hi-Hat Roll", "Trap/Drill", [],[],[],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],{style:"Triplet feel"}),
                    createPattern("Snare Roll Crescendo", "Orchestral", [],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[],[],[],{style:"Gradually increases in volume"}),
                ],
                "Latin": [
                    createPattern("Bossa Nova", "Brazilian", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Antônio Carlos Jobim", song: "The Girl from Ipanema", bpm: 129}),
                    createPattern("Samba", "Brazilian", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "Various", song: "N/A", bpm: 100}),
                    createPattern("Mambo", "Cuban", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0], [], [], [], {artist: "Pérez Prado", song: "Mambo No. 5", bpm: 178}),
                    createPattern("Cha-Cha", "Cuban", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0], [], [], [], {artist: "Enrique Jorrín", song: "N/A", bpm: 120}),
                    createPattern("Salsa", "Afro-Cuban", [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0], [0,0,0,0,1,0,0,1,0,0,0,0,1,0,0,1], [], [], [], {artist: "Celia Cruz", song: "La Vida Es Un Carnaval", bpm: 104}),
                ],
                "Metal": [
                    createPattern("Thrash Beat", "Thrash Metal", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Slayer", song: "Raining Blood", bpm: 178}),
                    createPattern("Blast Beat", "Death Metal/Black Metal", [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Napalm Death", song: "You Suffer", bpm: 240}),
                    createPattern("D-Beat", "Crust Punk/D-Beat", [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1], [], {artist: "Discharge", song: "Hear Nothing See Nothing Say Nothing", bpm: 190}),
                    createPattern("Metalcore Breakdown", "Metalcore", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], {artist: "As I Lay Dying", song: "Through Struggle", bpm: 95}),
                    createPattern("Groove Metal", "Groove Metal", [1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Pantera", song: "Walk", bpm: 117}),
                    createPattern("Power Metal", "Power Metal", [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Helloween", song: "Eagle Fly Free", bpm: 180}),
                    createPattern("Doom Metal Drag", "Doom Metal", [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "Black Sabbath", song: "Black Sabbath", bpm: 55}),
                ],
                 "Breakbeats": [
                    createPattern("Amen Break", "Funk/Soul", [1,0,0,1,0,1,0,0,1,0,1,1,0,1,0,0], [0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "The Winstons", song: "Amen, Brother", bpm: 136}),
                    createPattern("Funky Drummer", "Funk", [1,0,1,1,0,1,0,0,1,0,1,1,0,1,1,0], [0,0,0,0,1,0,1,0,0,0,0,0,1,0,1,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1], {artist: "James Brown", song: "Funky Drummer", bpm: 98}),
                    createPattern("Think Break", "Funk/Soul", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Lyn Collins", song: "Think (About It)", bpm: 112}),
                    createPattern("Apache", "Funk/Rock", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1], [], {artist: "Incredible Bongo Band", song: "Apache", bpm: 115}),
                    createPattern("The Big Beat", "Rock", [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0], [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0], [], [], [], {artist: "Billy Squier", song: "The Big Beat", bpm: 90}),
                ],
            };
            
            // --- Functions ---
            const initAudio = async () => { if (!audioReady) { await Tone.start(); audioReady = true; } };
            document.documentElement.addEventListener('mousedown', initAudio, { once: true });
            document.documentElement.addEventListener('touchstart', initAudio, { once: true });

            const stopPlayback = () => {
                if (currentSequence) { currentSequence.stop(0).dispose(); currentSequence = null; }
                Tone.Transport.stop(); Tone.Transport.position = 0; isPlaying = false;
                playIcon.classList.remove('hidden'); stopIcon.classList.add('hidden');
                document.querySelectorAll('.grid-cell.playing, .step-number.playing').forEach(el => el.classList.remove('playing'));
            };

            const startPlayback = () => {
                if (!selectedPattern || !audioReady) return;
                stopPlayback();
                const sequenceSteps = Array.from({ length: 16 }, (_, i) => i);
                const isAnySolo = Object.values(instrumentState).some(s => s.solo);

                currentSequence = new Tone.Sequence((time, step) => {
                    Object.keys(instruments).forEach(inst => {
                        const state = instrumentState[inst];
                        const patternHasNote = selectedPattern[inst] && selectedPattern[inst][step];
                        
                        if (patternHasNote) {
                            if (isAnySolo) {
                                if (state.solo) instruments[inst].triggerAttackRelease(inst === 'kick' ? 'C1' : '8n', '16n', time);
                            } else {
                                if (!state.mute) instruments[inst].triggerAttackRelease(inst === 'kick' ? 'C1' : '8n', '16n', time);
                            }
                        }
                    });
                    Tone.Draw.schedule(() => updatePlayhead(step), time);
                }, sequenceSteps, '16n').start(0);
                Tone.Transport.start(); isPlaying = true;
                playIcon.classList.add('hidden'); stopIcon.classList.remove('hidden');
            };

            const updatePlayhead = (step) => {
                document.querySelectorAll('.grid-cell.playing, .step-number.playing').forEach(el => el.classList.remove('playing'));
                const stepHeader = gridContainer.querySelector('.step-header');
                if (stepHeader && stepHeader.children[step + 1]) stepHeader.children[step + 1].classList.add('playing');
                gridContainer.querySelectorAll('.instrument-row').forEach(row => {
                    if (row.children[step + 1]) row.children[step + 1].classList.add('playing');
                });
            };

            const renderPatternGrid = (pattern) => {
                gridContainer.innerHTML = '';
                if (!pattern) return;
                const stepHeader = document.createElement('div');
                stepHeader.className = 'step-header flex items-center gap-1';
                const emptyLabel = document.createElement('div');
                emptyLabel.className = 'w-40 flex-shrink-0'; // Increased width for S/M buttons
                stepHeader.appendChild(emptyLabel);
                for (let i = 1; i <= 16; i++) {
                    const numberCell = document.createElement('div');
                    numberCell.className = 'step-number flex-1 h-6 rounded-sm flex items-center justify-center text-xs text-gray-500';
                    numberCell.textContent = i;
                    stepHeader.appendChild(numberCell);
                }
                gridContainer.appendChild(stepHeader);
                const instrumentOrder = ['kick', 'snare', 'clap', 'closedHat', 'openHat'];
                const instrumentLabels = { kick: 'Kick', snare: 'Snare', clap: 'Clap', closedHat: 'Hi-Hat (C)', openHat: 'Hi-Hat (O)' };
                instrumentOrder.forEach(instrumentKey => {
                    const row = document.createElement('div');
                    row.className = 'instrument-row flex items-center gap-1';
                    
                    const labelContainer = document.createElement('div');
                    labelContainer.className = 'w-40 flex-shrink-0 flex items-center justify-end pr-2';
                    
                    const soloBtn = document.createElement('button');
                    soloBtn.textContent = 'S';
                    soloBtn.className = `solo-btn w-6 h-6 text-xs font-bold rounded bg-gray-600 hover:bg-gray-500 transition-colors ${instrumentState[instrumentKey].solo ? 'active' : ''}`;
                    soloBtn.onclick = () => toggleSolo(instrumentKey);
                    
                    const muteBtn = document.createElement('button');
                    muteBtn.textContent = 'M';
                    muteBtn.className = `mute-btn w-6 h-6 text-xs font-bold rounded bg-gray-600 hover:bg-gray-500 transition-colors ml-1 ${instrumentState[instrumentKey].mute ? 'active' : ''}`;
                    muteBtn.onclick = () => toggleMute(instrumentKey);

                    const label = document.createElement('div');
                    label.className = 'text-sm font-semibold text-gray-400 ml-2 text-right flex-1';
                    label.textContent = instrumentLabels[instrumentKey];

                    labelContainer.appendChild(soloBtn);
                    labelContainer.appendChild(muteBtn);
                    labelContainer.appendChild(label);
                    row.appendChild(labelContainer);

                    const currentInstrumentPattern = Array.isArray(pattern[instrumentKey]) && pattern[instrumentKey].length > 0 ? pattern[instrumentKey] : [...emptyPattern];
                    for (let i = 0; i < 16; i++) {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell flex-1 h-6 sm:h-8 rounded-sm';
                        if (Math.floor(i / 4) % 2 === 1) cell.classList.add('alt-bg');
                        if (currentInstrumentPattern[i] === 1) cell.classList.add('active');
                        cell.dataset.instrument = instrumentKey;
                        cell.dataset.step = i;
                        cell.addEventListener('click', () => {
                            if (selectedPattern) {
                                if (!Array.isArray(selectedPattern[instrumentKey]) || selectedPattern[instrumentKey].length === 0) {
                                    selectedPattern[instrumentKey] = [...emptyPattern];
                                }
                                selectedPattern[instrumentKey][i] = selectedPattern[instrumentKey][i] === 1 ? 0 : 1;
                                cell.classList.toggle('active');
                                if (isPlaying) startPlayback();
                            }
                        });
                        row.appendChild(cell);
                    }
                    gridContainer.appendChild(row);
                });
            };
            
            const toggleSolo = (instKey) => {
                instrumentState[instKey].solo = !instrumentState[instKey].solo;
                if (instrumentState[instKey].solo) {
                    Object.keys(instrumentState).forEach(key => {
                        if (key !== instKey) instrumentState[key].solo = false;
                    });
                }
                renderPatternGrid(selectedPattern);
            };

            const toggleMute = (instKey) => {
                instrumentState[instKey].mute = !instrumentState[instKey].mute;
                renderPatternGrid(selectedPattern);
            };

            const selectPattern = (pattern) => {
                selectedPattern = JSON.parse(JSON.stringify(pattern));
                selectedPatternSpan.textContent = pattern.name;
                patternStyleDisplay.textContent = pattern.style || '';
                if (pattern.bpm) {
                    updateBpm(pattern.bpm);
                }
                renderPatternGrid(selectedPattern);
                playStopBtn.disabled = false; exportMidiBtn.disabled = false; detailsBtn.disabled = false;
                if (isPlaying) startPlayback();
            };

            const loadPatternsForGenre = (genre) => {
                patternListContainer.innerHTML = '';
                const patterns = drumPatterns[genre] || [];
                genreDidYouKnow.textContent = didYouKnowFacts[genre] || didYouKnowFacts["General"];
                patterns.forEach(pattern => {
                    const btn = document.createElement('button');
                    btn.className = 'w-full text-left p-3 rounded-md bg-gray-700 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:-translate-y-1';
                    btn.textContent = pattern.name;
                    btn.onclick = () => {
                        const currentActive = patternListContainer.querySelector('.bg-red-600');
                        if (currentActive) currentActive.classList.replace('bg-red-600', 'bg-gray-700');
                        btn.classList.replace('bg-gray-700', 'bg-red-600');
                        selectPattern(pattern);
                    };
                    patternListContainer.appendChild(btn);
                });
                if (patterns.length > 0) {
                    patternListContainer.firstChild.click();
                } else {
                    selectedPattern = null; selectedPatternSpan.textContent = 'None'; patternStyleDisplay.textContent = '';
                    renderPatternGrid(null);
                    playStopBtn.disabled = true; exportMidiBtn.disabled = true; detailsBtn.disabled = true;
                }
            };

            const switchGenre = (genre) => {
                stopPlayback(); currentGenre = genre;
                currentGenreSpan.textContent = genre;
                const newBpm = genreBPMs[genre] || 120;
                updateBpm(newBpm);
                loadPatternsForGenre(genre);
            };

            const updateBpm = (newBpm) => {
                const minBpm = parseInt(bpmSlider.min); const maxBpm = parseInt(bpmSlider.max);
                newBpm = Math.max(minBpm, Math.min(maxBpm, Math.round(newBpm)));
                bpmSlider.value = newBpm; 
                bpmValueSpan.textContent = newBpm;
                Tone.Transport.bpm.value = newBpm;
            };

            const exportMidi = () => {
                if (!selectedPattern) return;
                const track = new MidiWriter.Track();
                track.setTempo(Tone.Transport.bpm.value);
                const midiMap = { kick: 36, snare: 38, clap: 39, closedHat: 42, openHat: 46 };
                Object.keys(midiMap).forEach(instrument => {
                    const pattern = selectedPattern[instrument];
                    if (!pattern || pattern.length === 0) return;
                    pattern.forEach((hit, index) => {
                        if (hit) {
                            track.addEvent(new MidiWriter.NoteEvent({
                                pitch: [midiMap[instrument]], duration: '16', startTick: index * (128 / 4),
                                channel: 10, velocity: 100
                            }));
                        }
                    });
                });
                const write = new MidiWriter.Writer(track);
                const link = document.createElement('a');
                link.href = write.dataUri();
                link.download = `${currentGenre}_${selectedPattern.name.replace(/\s/g, '_')}.mid`;
                document.body.appendChild(link); link.click(); document.body.removeChild(link);
            };

            const updateDateTime = () => {
                const now = new Date();
                const optionsDate = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const optionsTime = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
                datetimeDisplay.textContent = `${now.toLocaleDateString('en-US', optionsDate)} | ${now.toLocaleTimeString('en-US', optionsTime)}`;
            };
            setInterval(updateDateTime, 1000); updateDateTime();

            const getSuggestions = (currentPattern) => {
                const allPatterns = Object.entries(drumPatterns).flatMap(([genre, patterns]) => patterns.map(p => ({...p, genre})));
                const suggestions = new Set();
                while(suggestions.size < 4 && suggestions.size < allPatterns.length -1) {
                    const randomIndex = Math.floor(Math.random() * allPatterns.length);
                    const randomPattern = allPatterns[randomIndex];
                    if (randomPattern.name !== currentPattern.name && randomPattern.genre !== currentPattern.genre) {
                        suggestions.add(randomPattern);
                    }
                }
                return Array.from(suggestions);
            }

            const openDetailsModal = () => {
                if (!selectedPattern) return;
                modalTitle.textContent = `${selectedPattern.name} - Details & More`;
                const suggestions = getSuggestions({...selectedPattern, genre: currentGenre});
                const randomFact = didYouKnowFacts["General"];
                let suggestionsHTML = suggestions.map(p => {
                    return `<button class="suggestion-btn w-full text-left p-2 rounded-md bg-gray-700 hover:bg-blue-600" data-genre="${p.genre}" data-pattern-name="${p.name}"><strong>${p.name}</strong> (${p.genre})</button>`;
                }).join('');
                modalBody.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-bold text-lg text-red-200">Inspired By</h4>
                            <p class="text-gray-300">${selectedPattern.artist || 'Various'} - "${selectedPattern.song || 'N/A'}"</p>
                        </div>
                        <div class="md:text-right">
                            <h4 class="font-bold text-lg text-red-200">Style</h4>
                            <p class="text-gray-300">${selectedPattern.style || 'N/A'}</p>
                        </div>
                    </div>
                    <div class="border-t border-gray-700 pt-4"><h4 class="font-bold text-lg text-red-200">Try Something Different</h4><div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">${suggestionsHTML}</div></div>
                    <div class="border-t border-gray-700 pt-4"><h4 class="font-bold text-lg text-red-200">Did You Know?</h4><p class="text-gray-300 italic">${randomFact}</p></div>
                    <div class="border-t border-gray-700 pt-4 text-center">
                         <a href="https://paypal.me/overtimegrind/10" target="_blank" class="paypal-btn font-bold py-2 px-4 rounded-lg shadow-lg inline-block text-sm">
                            <i class="fab fa-paypal mr-2"></i>Support This Project
                        </a>
                    </div>
                `;

                modalBody.querySelectorAll('.suggestion-btn').forEach(btn => {
                    btn.onclick = () => {
                        const newGenre = btn.dataset.genre;
                        const patternName = btn.dataset.patternName;
                        const patternToLoad = drumPatterns[newGenre].find(p => p.name === patternName);
                        if (patternToLoad) {
                            const targetGenreBtn = Array.from(document.querySelectorAll('.genre-btn')).find(b => b.dataset.genre === newGenre);
                            if(targetGenreBtn) targetGenreBtn.click();
                            const mainListBtns = Array.from(patternListContainer.querySelectorAll('button'));
                            const targetBtn = mainListBtns.find(b => b.textContent === patternName);
                            if(targetBtn) targetBtn.click();
                            closeModal();
                        }
                    };
                });
                detailsModal.classList.remove('opacity-0', 'pointer-events-none');
                modalContent.classList.remove('scale-95');
            };

            const closeModal = () => {
                detailsModal.classList.add('opacity-0', 'pointer-events-none');
                modalContent.classList.add('scale-95');
            };

            const handleTapTempo = () => {
                const now = performance.now();
                if (tapTimeout) clearTimeout(tapTimeout);
                if (tapTimes.length > 0 && (now - tapTimes[tapTimes.length - 1]) > 2000) { tapTimes = []; }
                tapTimes.push(now);
                if (tapTimes.length > 5) tapTimes.shift();
                if (tapTimes.length > 1) {
                    const intervals = [];
                    for (let i = 1; i < tapTimes.length; i++) { intervals.push(tapTimes[i] - tapTimes[i - 1]); }
                    const avgInterval = intervals.reduce((a, b) => a + b, 0) / intervals.length;
                    if (avgInterval > 0) updateBpm(60000 / avgInterval);
                }
                tapTimeout = setTimeout(() => { tapTimes = []; }, 2000);
            };

            // --- Event Listeners ---
            playStopBtn.addEventListener('click', () => { isPlaying ? stopPlayback() : startPlayback(); });
            bpmSlider.addEventListener('input', (e) => updateBpm(e.target.value));
            volumeSlider.addEventListener('input', (e) => { volumeValueSpan.textContent = e.target.value; Tone.Destination.volume.value = e.target.value; });
            swingSlider.addEventListener('input', (e) => {
                const swingAmount = parseInt(e.target.value) / 100;
                Tone.Transport.swing = swingAmount;
                swingValueSpan.textContent = e.target.value;
            });
            pitchSlider.addEventListener('input', (e) => {
                const pitchShift = parseInt(e.target.value);
                pitchValueSpan.textContent = `${pitchShift >= 0 ? '+' : ''}${pitchShift}`;
                Tone.Transport.set({ pitch: pitchShift });
            });
            genreButtons.forEach(btn => {
                btn.className = 'genre-btn bg-gray-700 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:-translate-y-1';
                btn.addEventListener('click', () => {
                    const genre = btn.dataset.genre;
                    switchGenre(genre);
                    genreButtons.forEach(b => b.classList.remove('bg-red-600'));
                    btn.classList.add('bg-red-600');
                });
            });
            exportMidiBtn.addEventListener('click', exportMidi);
            detailsBtn.addEventListener('click', openDetailsModal);
            closeModalBtn.addEventListener('click', closeModal);
            detailsModal.addEventListener('click', (e) => { if (e.target === detailsModal) closeModal(); });
            tapTempoBtn.addEventListener('click', handleTapTempo);

            // --- Initial Setup ---
            const init = () => {
                const hipHopButton = Array.from(document.querySelectorAll('.genre-btn')).find(btn => btn.dataset.genre === 'Hip Hop');
                if (hipHopButton) { hipHopButton.classList.add('bg-red-600'); }
                switchGenre('Hip Hop');
            };
            init();
        };
    </script>
</body>
</html>
